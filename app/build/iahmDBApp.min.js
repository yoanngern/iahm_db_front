/*! iahmDBApp 2015-07-29 */
"use strict";angular.module("iahmDBApp.connect",["ngRoute","angular-md5"]).config(["$routeProvider",function(a){a.when("/login",{templateUrl:"views/login.html",controller:"connectCtrl"})}]).controller("connectCtrl",["$scope","$http","$location","md5",function(a,b,c,d){a.$on("oauth:login",function(b,c){a.accessToken=c.access_token}),a.$on("oauth:logout",function(b){a.accessToken=null}),a.connect={state:d.createHash("test")},a.$on("oauth:login",function(a,b){console.log("Authorized third party app with token",b.access_token)}),a.$on("oauth:logout",function(a){console.log("The user has signed out")}),a.$on("oauth:loggedOut",function(a){console.log("The user is not signed in")}),a.$on("oauth:denied",function(a){console.log("The user did not authorize the third party app")}),a.$on("oauth:expired",function(a){console.log("The access token is expired. Please refresh.")}),a.$on("oauth:profile",function(a){console.log("User profile data retrieved: ",a)})}]),angular.module("iahmDBApp.editView",["ngRoute"]).config(["$routeProvider",function(a){a.when("/doc/:doc_type?/:id?/edit",{templateUrl:"views/edit.html",controller:"editCtrl"})}]).controller("editCtrl",["$scope","$http","$routeParams","$location",function(a,b,c,d){a.doc_type=c.doc_type,console.log(a.doc_type);var e="";a.doc={id:c.id},"contact"==a.doc_type&&(e="contacts",a.doc={id:c.id,contact:{firstname:"Yoann",lastname:"nom",title:"title",gender:"man",dateOfBirth:"1993-05-06",phones:[{number:"376418972365987",type:"mobile"}],emails:[{value:"yoann@yoanngern.ch",type:"private"}],languages:["fr","en"],comment_txt:"test blabla",type:"father",memberOfs:[],leaderOfs:[],events:[]}}),"event"==a.doc_type&&(e="events",a.doc={id:c.id,event:{title:"Mon super event2",start:"2011-06-05 12:15:00",end:"2012-06-05 12:15:00",parent:2,persons:[2],groups:[{group:{title:"test"}}]}});var f={method:"GET",dataType:"json",headers:{"Content-Type":"application/json"}};b.get("http://iahmdb.local/app_dev.php/api/"+e+"/"+a.doc.id+"?access_token="+a.oauth.access_token,f).success(function(b,c,d,e){a.doc.event.title=b.title,a.doc.event.end=b.end,a.doc.event.start=b.start,a.doc.event.groups=b.groups,a.doc.event.persons=b.participants,a.message=""}).error(function(a,b,c,d){}),console.log("edit: "+a.doc.id),a.saveDoc=function(){var c={event:a.doc.event};c.event.start="2011-06-05 12:15:00",c.event.end="2012-06-05 12:15:00",c.event.parent=2,c.event.persons=[],c.event.groups=[];var f={dataType:"json",headers:{"Content-Type":"application/json"}};b.put("http://iahmdb.local/app_dev.php/api/"+e+"/"+a.doc.id+"?access_token="+a.oauth.access_token,JSON.stringify(c),f).success(function(b,c,e,f){d.path("/doc/"+a.doc_type+"/"+a.doc.id)}).error(function(a,b,c,d){console.log(a)})}}]),angular.module("iahmDBApp",["ngRoute","ngStorage","ngLocale","angularMoment","LocalStorageModule","internationalPhoneNumber","iahmDBApp.secure","iahmDBApp.rest","iahmDBApp.oauth_callback","iahmDBApp.searchView","iahmDBApp.showView","iahmDBApp.editView","iahmDBApp.view2","iahmDBApp.version"]).config(["$routeProvider","$locationProvider","localStorageServiceProvider",function(a,b,c){a.otherwise({redirectTo:"/search",reloadOnSearch:!1}),c.setPrefix("iahm_db_front").setStorageType("sessionStorage")}]).controller("appCtrl",["$scope","$rootScope","$timeout","$location","$http","localStorageService","$filter","secure","rest",function(a,b,c,d,e,f,g,h,i){if(a.oauth=i.oauth,a.titlePage="IAHM DataBase",a.isLoggedIn=function(){return h.isLoggedIn},a.search={q:"",types:[],sort:"",countries:[],languages:[],birth_start:"",birth_end:"",before:"",after:""},a.message="",a.searchString="",a.searchConstructor={q:"*:*",entity:"",types:[]},a.refreshToken=function(){h.refreshToken(i.oauth)},a.login=function(){h.login(i.oauth)},null!=JSON.parse(window.localStorage.getItem("iahm_api"))){i.oauth.access_token=JSON.parse(window.localStorage.getItem("iahm_api")).oauth.access_token,i.oauth.refresh_token=JSON.parse(window.localStorage.getItem("iahm_api")).oauth.refresh_token,i.oauth.code=JSON.parse(window.localStorage.getItem("iahm_api")).oauth.code,window.localStorage.removeItem("iahm_api");var j={access_token:i.oauth.access_token,refresh_token:i.oauth.refresh_token};f.set("oauth",j)}f.get("oauth")&&(i.oauth.access_token=f.get("oauth").access_token,i.oauth.refresh_token=f.get("oauth").refresh_token,a.refreshToken()),a.$watch("oauth",function(){var a={access_token:i.oauth.access_token,refresh_token:i.oauth.refresh_token};f.set("oauth",a)},!0),a.logout=function(){h.isLoggedIn=!1},a.searchToString=function(){var b=a.search,c="";$(b.types).each(function(a,b){c+=" type:"+b}),""!=b.q&&(c+=" "+b.q),a.searchString=c+" ",d.search("search",a.searchString)},a.searchBuild=function(b){b&&(a.searchString=b);var c=a.searchString.split(" ");a.search.types=[],$(c).each(function(b,d){if(d.match("type:")){var e=d.match(/:([^ ]*)/)[1];""!=e&&-1==$.inArray(e,a.search.types)&&a.search.types.push(e),c=jQuery.grep(c,function(a){return a!=d})}""==d&&(c=jQuery.grep(c,function(a){return a!=d}))}),a.search.q=c.join(" ")},a.filterSearch=function(b){return"all"==b?(a.search.types=[],void a.searchToString()):(-1!=$.inArray(b,a.search.types)?a.search.types=jQuery.grep(a.search.types,function(a){return a!=b}):(a.searchString+=" type:"+b,a.searchBuild()),void a.searchToString())},a.$watch("search",function(){a.searchBuild()}),a.searchBuild(d.search().search),a.searchAll=function(){a.searchBuild()},a.$watch("searchConstructor",function(){a.searchValue="",$(a.searchConstructor.type).each(function(b,c){a.searchValue+=" type:"+c}),a.searchValue+=" "+a.searchConstructor.q}),a.calculateAge=function(a){a=moment(a);var b=Date.now()-a.toDate(),c=new Date(b);return Math.abs(c.getUTCFullYear()-1970)},b.$on("http_error",function(a,b){console.log("http_error")})}]).filter("searchFor",function(){return function(a,b){if(!b)return a;var c=[];return b=b.toLowerCase(),angular.forEach(a,function(a){-1!==a.text.toLowerCase().indexOf(b)&&c.push(a)}),c}}).filter("tel",function(){return function(a){if(!a)return"";var b=a.toString().trim().replace(/^\+/,"");if(b.match(/[^0-9]/))return a;var c,d;if(1==b.slice(0)){switch(b.length){case 10:c=1,city=b.slice(0,3),d=b.slice(3);break;case 11:c=b[0],city=b.slice(1,4),d=b.slice(4);break;case 12:c=b.slice(0,3),city=b.slice(3,5),d=b.slice(5);break;default:return a}return 1==c&&(c=""),d=d.slice(0,3)+"-"+d.slice(3),(c+" ("+city+") "+d).trim()}return 41==b.slice(0,2)?(c=41,d=b.slice(2),d=d.slice(0,2)+" "+d.slice(2,5)+" "+d.slice(5,7)+" "+d.slice(7),("+"+c+" "+d).trim()):33==b.slice(0,2)?(c=33,d=b.slice(2),d=d.slice(0,1)+" "+d.slice(1,3)+" "+d.slice(3,5)+" "+d.slice(5,7)+" "+d.slice(7),("+"+c+" "+d).trim()):49==b.slice(0,2)?(c=49,d=b.slice(2),d=d.slice(0,2)+" "+d.slice(2),("+"+c+" "+d).trim()):39==b.slice(0,2)?(c=39,d=b.slice(2),d=d.slice(0,2)+" "+d.slice(2,6)+" "+d.slice(6),("+"+c+" "+d).trim()):43==b.slice(0,2)?(c=43,d=b.slice(2),d=d.slice(0,1)+" "+d.slice(1),("+"+c+" "+d).trim()):32==b.slice(0,2)?(c=32,d=b.slice(2),d=d.slice(0,2)+" "+d.slice(2,4)+" "+d.slice(4,6)+" "+d.slice(6,8)+" "+d.slice(8),("+"+c+" "+d).trim()):31==b.slice(0,2)?(c=31,d=b.slice(2),d=d.slice(0,2)+" "+d.slice(2,5)+" "+d.slice(5),("+"+c+" "+d).trim()):b.trim()}}),Array.prototype.remove=function(a,b){var c=this.slice((b||a)+1||this.length);return this.length=0>a?this.length+a:a,this.push.apply(this,c)},angular.module("iahmDBApp.login",["ngRoute"]).config(["$routeProvider",function(a){a.when("/login",{templateUrl:"views/login.html",controller:"loginCtrl"})}]).controller("loginCtrl",["$scope","$http",function(a,b){}]),angular.module("iahmDBApp.oauth_callback",["ngRoute"]).config(["$routeProvider",function(a){a.when("/oauth_callback",{templateUrl:"views/oauth_callback.html",controller:"oauthCtrl"})}]).controller("oauthCtrl",["$scope","$http",function(a,b){console.log("oauth ctrl")}]),angular.module("iahmDBApp.rest",[]).factory("rest",["$rootScope","$http","$filter",function(a,b,c){var d={};d.Contact={},d.Entity={},d.Donation={},d.Group={},d.Location={},d.Event={},d.oauth={client_id:"19_64bxhmfwc8g8c4s0w8w04g4s004o00o44wswg8csw8cgc4cksk",redirect_uri:"http://iahmdb-front.local/oauth_callback.php",response_type:"token",expires_in:null,access_token:"",refresh_token:"",code:"",scope:"",token_type:""};var e=function(a,b){var c=[];return $(a).each(function(a,d){c.push(d[b])}),c},f=function(a){var b=[];return $(a).each(function(a,c){null!=c.$$hashKey&&delete c.$$hashKey,null!=c.id&&delete c.id,$.isEmptyObject(c)||b.push(c)}),b};return d.Contact.getContact=function(a){d.getRest("contacts/"+a,"ContactReceived")},d.Contact.getDonations=function(a){d.getRest("contacts/"+a+"/donations","DonationsReceived")},d.Contact.getEvents=function(a){d.getRest("contacts/"+a+"/events","EventsReceived")},d.Contact.getGroups=function(a){d.getRest("contacts/"+a+"/groups","ContactGroupsReceived")},d.Contact.putContact=function(a){if(null==a)return!1;var b={contact:{firstname:a.firstname,lastname:a.lastname,title:a.title,gender:a.gender,dateOfBirth:moment(a.date_of_birth).format("YYYY-MM-DDThh:mm:ss.SSS")+"Z",phones:f(a.phones),emails:f(a.emails),languages:e(a.languages,"ref"),comment_txt:a.comment}};d.putRest("contacts/"+a.id,b,"ContactUpdated")},d.Contact.putEvent=function(a,b){return null==a||null==b?!1:void d.putRest("contacts/"+a.id+"/events/"+b.id,null,"ContactEventUpdated")},d.Contact.putGroups=function(a){if(null==a)return!1;console.log(a);var b={contact:{leaderOfs:f(a.leaderOfGroups),memberOfs:f(a.memberOfGroups)}};console.log(b),d.putRest("contacts/"+a.id+"/groups",b,"ContactGroupsUpdated")},d.Contact.putEvents=function(a){if(null==a)return!1;console.log(a);var b={contact:{events:e(a.events,"id")}};console.log(b),d.putRest("contacts/"+a.id+"/events",b,"ContactEventsUpdated")},d.Contact.putLeader=function(a,b){return null==a||null==b?!1:void d.putRest("contacts/"+a.id+"/leaders/"+b.id,null,"ContactGroupUpdated")},d.Contact.putMember=function(a,b){return null==a||null==b?!1:void d.putRest("contacts/"+a.id+"/members/"+b.id,null,"ContactGroupUpdated")},d.Contact.postDonation=function(a,b){if(null==a||null==b)return!1;var c={donation:{date:moment(b.date).format("YYYY-MM-DD hh:mm:ss"),amount:b.amount,currency:b.currency,type:b.type,comment_txt:b.comment}};d.postRest("contacts/"+a.id+"/donations",c,"DonationCreated")},d.Event.getEvent=function(a){d.getRest("events/"+a,"EventReceived")},d.Event.getEvents=function(){d.getRest("events","allEventsReceived")},d.Event.putEvent=function(a){if(null==a)return!1;$(a.childrens).each(function(a,b){b.start=c("date")(b.start,"yyyy-MM-dd HH:mm:ss"),b.end=c("date")(b.end,"yyyy-MM-dd HH:mm:ss")});var b={event:{title:a.title,start:c("date")(a.start,"yyyy-MM-dd HH:mm:ss"),end:c("date")(a.end,"yyyy-MM-dd HH:mm:ss"),parent:a.parent.id,persons:e(a.participants,"id"),childrens:f(a.childrens),groups:f(a.groups)}};d.putRest("events/"+a.id,b,"EventUpdated")},d.Entity.getEntity=function(a){d.getRest("entities/"+a,"EntityReceived")},d.Entity.getDonations=function(a){d.getRest("entities/"+a+"/donations","DonationsReceived")},d.Entity.getGroups=function(a){d.getRest("entities/"+a+"/groups","GroupsReceived")},d.Entity.putEntity=function(a){if(null==a)return!1;var b={entity:{type:a.type,name:a.name,emails:f(a.emails),phones:f(a.phones),comment_txt:a.comment}};d.putRest("entities/"+a.id,b,"EntityUpdated")},d.Donation.putDonation=function(a){if(null==a)return!1;var b={donation:{date:moment(a.date).format("YYYY-MM-DDThh:mm:ss.SSS")+"Z",amount:a.amount,currency:a.currency,type:a.type,person:a.contact_id,comment_txt:a.comment.text,entity:null}};d.putRest("donations/"+a.id,b,"DonationUpdated")},d.Location.putLocation=function(a){if(null==a)return!1;var b={location:{address:a.address,postbox:a.postbox,district:a.district,city:a.city,department:a.department,postalCode:a.postal_code,country:a.country,type:a.type}};d.putRest("locations/"+a.id,b,"EntityUpdated")},d.Group.getGroup=function(a){d.getRest("groups/"+a,"GroupReceived")},d.Group.getGroups=function(){d.getRest("groups","allGroupsReceived")},d.Group.putGroup=function(a){if(null==a)return!1;if(null!=a.event)var b=a.event.id;var c={group:{title:a.title,event:b,parent:a.parent.id,members:e(a.members,"id"),leaders:e(a.leaders,"id"),childrens:f(a.childrens),entities:e(a.entities,"id")}};d.putRest("groups/"+a.id,c,"GroupUpdated")},d.putRest=function(c,e,f){e=null==e?null:JSON.stringify(e);var g={dataType:"json",headers:{"Content-Type":"application/json"}};b.put("http://iahmdb.local/app_dev.php/api/"+c+"?access_token="+d.oauth.access_token,e,g).success(function(b,c,d,e){a.$broadcast(f,b),console.log(b)}).error(function(b,c,d,e){"invalid_grant"==b.error&&a.$broadcast("http_error",b)})},d.postRest=function(c,e,f){e=null==e?null:JSON.stringify(e);var g={dataType:"json",headers:{"Content-Type":"application/json"}};b.post("http://iahmdb.local/app_dev.php/api/"+c+"?access_token="+d.oauth.access_token,e,g).success(function(b,c,d,e){a.$broadcast(f,b),console.log(b)}).error(function(b,c,d,e){"invalid_grant"==b.error&&a.$broadcast("http_error",b)})},d.getRest=function(c,e){var f={method:"GET",headers:{"Content-Type":"application/json"}};b.get("http://iahmdb.local/app_dev.php/api/"+c+"?access_token="+d.oauth.access_token,f).success(function(b,c,d,f){a.$broadcast(e,b)}).error(function(a,b,c,d){return!1})},d}]),angular.module("iahmDBApp.searchView",["ngRoute"]).config(["$routeProvider",function(a){a.when("/search",{templateUrl:"views/search.html",controller:"searchCtrl",reloadOnSearch:!1})}]).controller("searchCtrl",["$scope","$http","$location","rest",function(a,b,c,d){a.results=[],a.searchRequest="",a.showView=function(b,d){a.message="loading...",c.path("doc/"+b+"/"+d)},a.$watch("searchConstructor",function(){""!=a.searchConstructor.q?a.searchRequest=a.searchConstructor.q:a.searchRequest="",a.searchConstructor.entity&&(a.searchRequest+=" AND doc_type:"+a.searchConstructor.entity)},!0),a.$watch("search",function(){var c="";$(a.search.types).each(function(b){""!=this&&(0==b&&(c="("),"("!=c&&(c+=" OR "),c+=""+this,b==a.search.types.length-1&&(c+=")"))});var e={method:"GET",headers:{"Content-Type":"application/javascript"},params:{q:a.search.q,type:c,access_token:d.oauth.access_token}};a.message="loading...",b.get("http://iahmdb.local/app_dev.php/api/search",e).success(function(b,c,d,e){a.results=b,a.message=""}).error(function(b,c,d,e){"invalid_grant"==b.error&&a.refreshToken()})},!0)}]),angular.module("iahmDBApp.secure",[]).factory("secure",["$http","$rootScope",function(a,b){var c={isLoggedIn:!1};return c.login=function(a){window.location.href="http://iahmdb.local/app_dev.php/oauth/v2/auth?client_id="+a.client_id+"&response_type=code&redirect_uri="+a.redirect_uri},c.refreshToken=function(b){a.get("http://iahmdb-front.local/refresh_token.php?refresh_token="+b.refresh_token).success(function(a,d,e,f){b.access_token=a.access_token,b.expires_in=a.expires_in,b.refresh_token=a.refresh_token,b.scope=a.scope,b.token_type=a.token_type,c.isLoggedIn=!0}).error(function(a,d,e,f){c.isLoggedIn=!1,400==d&&c.login(b)})},c}]),angular.module("iahmDBApp.showView",["ngRoute","ngTagsInput","sbDateSelect"]).config(["$routeProvider",function(a){a.when("/doc/:doc_type?/:id?",{templateUrl:"views/show.html",controller:"showCtrl"})}]).controller("showCtrl",["$scope","$rootScope","$http","$routeParams","$location","$filter","rest",function(a,b,c,d,e,f,g){a.loading=!0,a.routeParams=d,a.doc_type=d.doc_type;var h="";("undefined"==typeof d.doc_type||"undefined"==typeof d.id)&&e.path("/search"),"contact"==a.doc_type&&(h="contacts",a.tabs=[{title:"Informations générales",url:"infos.tpl.html"},{title:"Evénements",url:"events.tpl.html"},{title:"Groupes",url:"groups.tpl.html"},{title:"Adresses",url:"locations.tpl.html"},{title:"Dons",url:"donations.tpl.html"},{title:"Entités",url:"entities.tpl.html"}]),"event"==a.doc_type&&(h="events",a.tabs=[{title:"Informations générales",url:"infos.tpl.html"},{title:"Groupes",url:"groups.tpl.html"}]),"entity"==a.doc_type&&(h="entities",a.tabs=[{title:"Informations générales",url:"infos.tpl.html"},{title:"Groupes",url:"groups.tpl.html"},{title:"Dons",url:"donations.tpl.html"}]),"group"==a.doc_type&&(h="groups",a.tabs=[{title:"Informations générales",url:"infos.tpl.html"},{title:"Membres",url:"members.tpl.html"}]),a.doc={id:d.id},a.getDoc=function(){"contact"==a.doc_type&&(g.Contact.getContact(a.doc.id),g.Contact.getDonations(a.doc.id),g.Contact.getEvents(a.doc.id),g.Contact.getGroups(a.doc.id)),"event"==a.doc_type&&(g.Event.getEvent(a.doc.id),g.Event.getEvents()),"entity"==a.doc_type&&(g.Entity.getEntity(a.doc.id),g.Entity.getGroups(a.doc.id),g.Entity.getDonations(a.doc.id)),"group"==a.doc_type&&(g.Group.getGroup(a.doc.id),g.Event.getEvents(),g.Group.getGroups())},a.getDoc(),a.tags={},a.results=[],a.getCodeLanguages=function(){c.get("/data/code_languages.json").success(function(b){$(b).each(function(a,b){b.text=b.en_name+" "+b.fr_name+" "+b.es_name+" "+b.de_name+" "+b.it_name+" "+b.pt_name}),a.code_langues=b})},$("#page").on("click","div.searchEdit div.results",function(){$("input",this).focus()}).on("focus","div.searchEdit input",function(){var a=$(this).parent().parent();$("ul.found",a).show()}).on("click","div.searchEditor div.results",function(){$("input.search",this).focus()}).on("focus","div.searchEditor input.search",function(){var a=$(this).parent().parent();""!=$(this).val()&&$("ul.found li",a).length&&$("ul.found",a).show()}),a.addEditItem=function(a){var b={};a.push(b)},a.newDoc=function(b,c){var d={};b.push(d),a[c]=!0},a.removeItem=function(a,b){var c=a.indexOf(b);a.splice(c,1)},a.addToResults=function(b,c){var d=!1;if("language"==b){var e={ref:c.code,name:c.fr_name};$(a.contact.languages).each(function(a,b){c.code==b.ref&&(d=!0)}),d||(a.contact.languages.push(e),$("div[data-type="+b+"] input.search").val(""))}"parentEvent"==b&&(a.event.parent=c),"groupEvent"==b&&(a.group.event=c),"groupParent"==b&&(a.group.parent=c),d||$("div[data-type="+b+"] .found").hide()},a.removeToResults=function(b,c){"language"==b&&$(a.contact.languages).each(function(b,d){c.ref==d.ref&&a.contact.languages.remove(b)})},$("html").click(function(){$("div.searchEdit .found").hide()}).on("click","div.searchEdit",function(a){a.stopPropagation()}).click(function(){$("div.searchEditor .found").hide()}).on("click","div.searchEditor .search",function(a){a.stopPropagation()}),a.getCodeLanguages(),a.currentTab="infos.tpl.html",a.onClickTab=function(b){a.currentTab=b.url},a.isActiveTab=function(b){return b==a.currentTab},a.editItem=function(b){a[b]=!0},a.cancelItem=function(b,c){"contact"==b&&g.Contact.getContact(a.doc.id),"event"==b&&g.Event.getEvent(a.doc.id),a[c]=!1},a.saveItem=function(b,c,d){console.log("saveItem()"),console.log(d),"contact"==b&&g.Contact.putContact(a.doc.contact),"entity"==b&&g.Entity.putEntity(a.doc.entity),"event"==b&&g.Event.putEvent(a.doc.event),"group"==b&&g.Group.putGroup(a.doc.group),"contactDonation"==b&&(null==d.id?g.Contact.postDonation(a.doc.contact,d):g.Donation.putDonation(d)),"entityLocation"==b&&$(a.doc.entity.locations).each(function(a,b){g.Location.putLocation(b)}),a[c]=!1},a.searchEditor={search:"",display:!1,type:"contact",arrayResult:[],items:[],found:[]},a.searchEditor.addItem=function(b){var c=!1;if("contact"==a.searchEditor.type)var d={id:b.entity_id,firstname:b.firstname,lastname:b.lastname};if("event"==a.searchEditor.type)var d={id:b.entity_id,title:b.title,start:b.start,end:b.end};if("group"==a.searchEditor.type)var d={id:b.entity_id,title:b.title};$(a.searchEditor.items).each(function(a,b){d.id==b.id&&(c=!0)}),c||(a.searchEditor.items.push(d),$(".searchEditor .found").hide())},a.searchEditor.save=function(){if("contact"==a.searchEditor.entity&&"event"==a.searchEditor.type){var b={id:a.doc.contact.id,events:a.doc.events};g.Contact.putEvents(b)}if("event"==a.searchEditor.entity&&"contact"==a.searchEditor.type&&g.Event.putEvent(a.doc.event),"entity"==a.searchEditor.entity&&g.Entity.putEntity(a.doc.entity),"contact"==a.searchEditor.entity&&"group"==a.searchEditor.type){var b={id:a.doc.contact.id,leaderOfGroups:a.doc.leaderOfGroups,memberOfGroups:a.doc.memberOfGroups};g.Contact.putGroups(b)}a.searchEditor.display=!1},a.searchEditor.cancel=function(){"contact"==a.searchEditor.entity&&g.Contact.getContact(a.doc.id),"event"==a.searchEditor.entity&&g.Event.getEvent(a.doc.id),a.searchEditor.display=!1},a.$watch("searchEditor.search",function(){if(""!=a.searchEditor.search&&$(".searchEditor ul.found li").length&&$(".searchEditor ul.found").show(),""==a.searchEditor.search)return!1;var b={method:"GET",headers:{"Content-Type":"application/javascript"},params:{q:a.searchEditor.search,type:a.searchEditor.type,access_token:g.oauth.access_token}};c.get("http://iahmdb.local/app_dev.php/api/search",b).success(function(b,c,d,e){a.searchEditor.found=b.documents}).error(function(b,c,d,e){"invalid_grant"==b.error&&a.refreshToken()})}),a.openSearchEditor=function(b,c,d){a.searchEditor.items=b,a.searchEditor.type=c,a.searchEditor.entity=d,a.searchEditor.display=!0},a.isDocFocus=function(b){return a.docFocus==b},a.setDocFocus=function(b){a.docFocus=b},b.$on("ContactReceived",function(b,c){if(null==c)return!1;var d=[];$(c.languages).each(function(b,c){$(a.code_langues).each(function(a,b){if(c.ref==b.code){var e={name:b.fr_name,ref:c.ref};d.push(e)}})}),c.languages=d,a.doc.contact=c,a.doc.contact.date_of_birth=moment(a.doc.contact.date_of_birth),a.contact=a.doc.contact,a.loading=!1},!0),b.$on("DonationsReceived",function(b,c){return null==c?!1:(a.doc.donations=c.donations,void(a.donations=a.doc.donations))},!0),b.$on("EventsReceived",function(b,c){return null==c?!1:(a.doc.events=c.events,void(a.events=a.doc.events))},!0),b.$on("ContactGroupsReceived",function(b,c){return null==c?!1:(a.doc.leaderOfGroups=c.leaderOfGroups,a.doc.memberOfGroups=c.memberOfGroups,a.leaderOfGroups=a.doc.leaderOfGroups,void(a.memberOfGroups=a.doc.memberOfGroups))},!0),b.$on("ContactUpdated",function(b,c){g.Contact.getContact(a.doc.id)},!0),b.$on("ContactGroupsUpdated",function(b,c){g.Contact.getContact(a.doc.id),g.Contact.getGroups(a.doc.id)},!0),b.$on("ContactEventsUpdated",function(b,c){g.Contact.getContact(a.doc.id),g.Contact.getEvents(a.doc.id)},!0),b.$on("EventReceived",function(b,c){return null==c?!1:(a.doc.event=c,a.doc.event.start=new Date(f("date")(a.doc.event.start,"yyyy-MM-dd")),a.doc.event.end=new Date(f("date")(a.doc.event.end,"yyyy-MM-dd")),$(a.doc.event.childrens).each(function(a,b){b.start=new Date(f("date")(b.start,"yyyy-MM-dd")),b.end=new Date(f("date")(b.end,"yyyy-MM-dd"))}),a.event=a.doc.event,void(a.loading=!1))},!0),b.$on("allEventsReceived",function(b,c){return null==c?!1:(a.doc.allEvents=c,a.doc.allEvents.start=new Date(f("date")(a.doc.allEvents.start,"yyyy-MM-dd")),a.doc.allEvents.end=new Date(f("date")(a.doc.allEvents.end,"yyyy-MM-dd")),void(a.allEvents=a.doc.allEvents))},!0),b.$on("allGroupsReceived",function(b,c){return null==c?!1:(a.doc.allGroups=c,void(a.allGroups=a.doc.allGroups))},!0),b.$on("EntityReceived",function(b,c){return null==c?!1:(a.doc.entity=c,a.entity=a.doc.entity,void(a.loading=!1))},!0),b.$on("EntityUpdated",function(b,c){g.Entity.getEntity(a.doc.id)},!0),b.$on("EventUpdated",function(b,c){g.Event.getEvent(a.doc.id)},!0),b.$on("DonationUpdated",function(b,c){"contact"==a.doc_type?g.Contact.getDonations(a.doc.id):"entity"==a.doc_type&&g.Entity.getDonations(a.doc.id)},!0),b.$on("GroupReceived",function(b,c){return null==c?!1:(a.doc.group=c,a.group=a.doc.group,void(a.loading=!1))},!0),b.$on("ContactGroupUpdated",function(b,c){g.Contact.getContact(a.doc.id),g.Contact.getGroups(a.doc.id)},!0),b.$on("GroupUpdated",function(b,c){g.Group.getGroup(a.doc.id)},!0)}]),angular.module("iahmDBApp.view2",["ngRoute"]).config(["$routeProvider",function(a){a.when("/view2",{templateUrl:"view2/view2.html",controller:"View2Ctrl"})}]).controller("View2Ctrl",[function(){}]);